{% macro render_back_button() %}
    <a class='mx-4 btn btn-primary text-light align-self-center' role='button'
       href='{{ url_range_aware('dashboard:dashboard', start_time, end_time) }}'>
        <span class='oi oi-arrow-left' aria-hidden='true'></span>
        Dashboard
    </a>
{% endmacro %}

{% macro render_item_table(table_data, page=0, page_size=0) %}
    <table class='table table-striped mt-4'>
        <tr>
            <th scope='col'>#</th>
            <th scope='col'>Item</th>
            <th scope='col'>Experiment</th>
            <th scope='col'>Assay Type</th>
            <th scope='col'>Hits</th>
            <th scope='col'>Details</th>
        </tr>
        {% for item, count in table_data %}
            {% set name = render_s3_key(item.s3_key) %}
            <tr>
                {% set count_label = page_size * page + loop.index %}
                <th scope='row'>{{ count_label }}</th>
                <td>
                    <a target='_blank'
                       href='{{ get_encode_url('files/' + name.split('.')[0]) }}'>{{ name }}
                        <span class='ml-2 oi oi-link-intact' aria-hidden='true'></span>
                    </a>
                </td>
                <td>
                    {% if item.experiment is not none %}
                        <a target='_blank'
                           href='{{ get_encode_url('experiments/' + item.experiment.name) }}'>
                            {{ item.experiment.name }}
                            <span class='ml-2 oi oi-link-intact' aria-hidden='true'></span>
                        </a>
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ item.assay_title or 'N/A' }}</td>
                <td>{{ count }}</td>
                <td>
                    <a id='btn-item-{{ loop.index0 }}'
                       href='{{ url_range_aware('dashboard:item_dashboard', start_time, end_time, kwargs={'item_name': name}) }}'>
                        Details
                        <span class='ml-2 oi oi-bar-chart' aria-hidden='true'></span>
                    </a>
                </td>
            </tr>
        {% endfor %}
    </table>
{% endmacro %}

{% macro render_user_table(users, page=0, page_size=0) %}
    <table class='table table-striped mt-4'>
        <tr>
            <th scope='col'>#</th>
            <th scope='col'>IP Address</th>
            <th scope='col'>Requester</th>
            <th scope='col'>Hits</th>
        </tr>
        {% for user in users %}
            {% set requester = user['requester'] %}
            {% set ip_address = user['ip_address'] %}
            <tr>
                {% set count_label = page_size * page + loop.index %}
                <th scope='row'>{{ count_label }}</th>
                <td>
                    {% if ip_address is not none %}
                        <a id='btn-requester-{{ loop.index0 }}'
                           href='{{ url_range_aware('dashboard:ip_address_dashboard', start_time, end_time, kwargs={'ip_address': ip_address}) }}'>
                            {{ ip_address }}
                        </a>
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if requester is not none %}
                        <a id='btn-requester-{{ loop.index0 }}'
                           href='{{ url_range_aware('dashboard:requester_dashboard', start_time, end_time, kwargs={'requester':requester}) }}'>
                            {{ requester }}
                        </a>
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ locale_format(user['count']) }}</td>
            </tr>
        {% endfor %}
    </table>
{% endmacro %}

{% macro render_table_row(table_render, data, header, page=0, page_size=0) %}
    {% if data is not none %}
        <div class='row mt-4 mx-4'>
            <div class='col text-center'>
                <h1>{{ header }}</h1>
            </div>
            {{ table_render(data, page, page_size) }}
        </div>
    {% endif %}
{% endmacro %}

{% macro render_time_range() %}
    {% if not is_default %}
        <div class='row'>
            <div class='col text-center'>
                <hr>
                <p class='lead mb-0'>From {{ start_time.strftime('%m/%d/%Y') }}
                    to {{ end_time.strftime('%m/%d/%Y') }}
                </p>
            </div>
        </div>
    {% endif %}
{% endmacro %}

{% macro render_stat(stat, display_name, format='regular') %}
    <div class='col text-center m-4'>
        {% if stat is not none %}
            <p class='counter display-3' format='{{ format }}'
               {% if is_default %}data-count='{{ stat }}'>
                   0
               {% else %}>
                   {{ stat }}
               {% endif %}
            </p>
        {% else %}
            <p class='display-2'>None</p>
        {% endif %}
        <h3 class='fade-in-header'>{{ display_name }}</h3>
    </div>
{% endmacro %}

{% macro ajax_table(view_name, table_id, start_time=None, end_time=None, kwargs=None) %}
    $.ajax({
        url: '{{ url_range_aware(view_name, start_time, end_time, kwargs) }}',
        success: function (result) {
            $('#{{ table_id }}').fadeTo(0, 0).html(result).fadeTo(500, 1);
        },
        error: function (error) {
            $('#{{ table_id }}').children().first().html('Error loading table data')
        }
    });
{% endmacro %}
